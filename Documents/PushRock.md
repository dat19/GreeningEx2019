# 岩を押す時の動作

![岩転がし](Images/rock-move.mp4)

岩を転がして、段差に落とす時の動作がぎこちない。

　岩を押すような処理は、2つのオブジェクトが関わってくるので制御が複雑になる。押した後の状況が多岐にわたるため、あらゆる状況を想定した上で、最適なルールを考え出す必要がある。どのように動かしたいかを明確にした上で、実際に発生しうる状況を洗い出して、最適なルールを検討する。

## 目的の動き
- 岩が転がれる間は、ステラの歩きを妨げたくない
- 岩の下が無くなったら、岩は直下に落ちる。その間は、ステラは岩に乗れる高さになるまで移動できなくする
- 岩が着地している時はミニジャンプ可能
- 岩が落下中にミニジャンプをすると座標がズレて飛びすぎてしまうため、段差を乗り越えるのみにする
- 現在、段差を乗り越えようとした後にまた戻るという動きがあるので、乗ったならそのまま乗り切らせたい

## 現状
- ステラが歩く時に前に何かあったら、PushActionを呼び出す
- PushAction側で、ステラの移動分、岩を押す処理を実施。現在の問題は、落下が途中に挟まっているのが原因と思われる
- 岩が縁にある時に押すと、円弧の分、空中に判定されるフレームが発生する。この時に押せないと判定されて、ステラが止まってしまう

## 解決策
- 現在は移動量からYの値を算出しているが、完全な処理ができていない
- 岩の半径分、下にキャストして接触点を探す
- 接触点から上にキャストして、岩との接点を求める



の中心の高さから、端の半径分下を走査して、地面がなければ落ちたと見なせそう
- 地面があれば、その高さに補正して着地
- 地面がなければY速度を0にして、落下へ
